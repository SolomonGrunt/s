<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Platformer</title>
    <link rel="stylesheet" type="text/css"   href="/css/styles.css">
    <link rel="icon" type="image/x-icon" href="/js/images/mstile-150x150.png">
    <script type="js" src="/js/player.js"> </script>
    <script type="js" src="/js/index.js"></script>
    <script type="js" src="/js/border.js"> </script>
    <script type="js" src="/js/Scrolling.js"></script>

</head>
<body>
<div class="topnav">
    <a class="active" href="/views/profile.ejs">Profile</a>
    <a href="/views/donations.ejs">Donations</a>
    <a href="/views/main.ejs">Main</a>
    <a href="/views/desc.ejs">About Us</a>
</div>
<h1> Amgame   </h1>
<h1>Score: <span id="score">0</span></h1>
<h1>  </h1>
<p class="scrollable-place">
    <button onclick="disable()">Start game</button>
    <button onclick="enable()">End game </button>
<button onclick="alert(score)"> asdasd</button>
   <! -- this is so spaghetti -->
    <script> function disable() {

            TopScroll = window.pageYOffset || document.documentElement.scrollTop;
            LeftScroll = window.pageXOffset || document.documentElement.scrollLeft,
// this is not depreciated it works and google says it isnt i have no idea why it says this
                window.onscroll = function() {
                    window.scrollTo(LeftScroll, TopScroll);
                };
        }
        function enable() {
            window.onscroll = function() {};
        }
    </script>
    <script>function Border(x,y,width, height,type){
            this.x =x;
            this.y =y;
            this.width = width;
            this.height = height;
            this.type = type;

            this.draw = function (){
                if (this.type ===1){
                    ctx.fillStyle = 'green'; //wall
                } else if(this.type ===2){
                    ctx.fillStyle = 'red'; //deathblock
                }else if(this.type ===3){
                    ctx.fillStyle = 'yellow'; //coin
                }else if(this.type ===4){
                    ctx.fillStyle = 'black'; //power
                }
                ctx.fillRect(this.x,this.y,this.width , this.height);
            }
        }</script>
    <script> var canvas;
        var ctx;
        var upKey;
        var rightKey;
        var leftKey;
        var downKey;
        var gameloop;
        var player;
        var score =0;
        var borders =[ ];
        window.onload = function () {
            canvas = document.getElementById("game-canvas");
            ctx = canvas.getContext("2d");
            //
            setupInputs();
            player = new Player(200 , 500);
            for (let i =0; i <6; i++){
                borders.push(new Border(0+100*i , 620 , 100 ,100 ,1));
            }
            for (let i =0; i <6; i++){
                borders.push(new Border(0+100*i , 620 , 100 ,100 ,1));
            }
            // dont touch down
            for (let j =0; j <16; j++){
                borders.push(new Border(0+100*j , 0 , 100 ,5 ,1));
            }
            for (let j =0; j <4; j++){
                borders.push(new Border(0 , 0+100*j , 10 ,500 ,1));
            }
            for (let j =0; j <4; j++){
                borders.push(new Border(1270 , 0+100*j , 10 ,500 ,1));
            }
            for (let j =0; j <16; j++){
                borders.push(new Border(0+100*j , 720 , 100 ,5 ,1));
            }
            // dont touch ^
            for (let i =0; i <3; i++){
                borders.push(new Border(100+200*i , 160 , 50 ,50 ,3));
            }
            //
            borders.push(new Border(666 , 520 , 100 ,50 ,1));
            borders.push(new Border(666 , 620 , 100 ,50 ,2));
            borders.push(new Border(0 , 520 , 100 ,100 ,2));
            borders.push(new Border(600 , 620 , 60 ,50 ,3));
            borders.push(new Border(100 , 370 , 100 ,100 ,4)); // powerup
            borders.push(new Border(10 , 370 , 50 ,50 ,3));
            for (let i =0; i <6; i++){
                borders.push(new Border(0+120*i , 320 , 50 ,50 ,1));

            }

            // dont touch down
            for (let j =0; j <16; j++){
                borders.push(new Border(0+100*j , 0 , 100 ,5 ,1));
            }
            for (let j =0; j <4; j++){
                borders.push(new Border(0 , 0+100*j , 10 ,500 ,1));
            }
            for (let j =0; j <4; j++){
                borders.push(new Border(1270 , 0+100*j , 10 ,500 ,1));
            }
            for (let j =0; j <16; j++){
                borders.push(new Border(0+100*j , 720 , 100 ,5 ,1));
            }
            // dont touch ^
            borders.push(new Border(666 , 620 , 100 ,50 ,2));

            gameloop = setInterval(step , 1000/30);
            ctx.fillStyle = "rgba(102,255,0,0.09)"
            ctx.fillRect(0 , 0 ,1280 , 720)
        }
        function step () {
            player.step();
            draw();

        }
        function draw (){
            ctx.fillStyle = 'white';
            ctx.fillRect(0,0,1280,720);
            player.draw();
            for (let i =0; i< borders.length; i++){
                borders[i].draw();
            }

        }
        function setupInputs () {
            document.addEventListener("keydown" , function (event){
                if(event.key === "w" || event.key === "ArrowUp"){
                    upKey = true;
                } else if(event.key === "a" || event.key === "ArrowLeft"){
                    leftKey =true;
                }else if(event.key === "s" || event.key === "ArrowDown"){
                    downKey =true;
                }else if(event.key === "d" || event.key === "ArrowRight"){
                    rightKey=true;
                }
            });
            document.addEventListener("keyup" , function (event){
                if(event.key === "w" || event.key === "ArrowUp"){
                    upKey = false;
                } else if(event.key === "a" || event.key === "ArrowLeft"){
                    leftKey =false;
                }else if(event.key === "s" || event.key === "ArrowDown"){
                    downKey =false;
                }else if(event.key === "d" || event.key === "ArrowRight"){
                    rightKey=false;
                } else if(event.key === "q"){
                    document.location.reload();
                }
            });
        }
        function checkIntersection(r1,r2){
            if(r1.x >= r2.x + r2.width){
                return false;
            } else if(r1.x +r1.width <= r2.x){
                return false;
            } else if (r1.y >= r2.y +r2.height){
                return false;
            }else if( r1.y + r1.height <= r2.y){
                return false;
            }else {
                return  true;
            }
        }</script>
    <script>
        function Player(x,y){
            this.x =x;
            this.y =y;
            this.xspeed=0;
            this.yspeed=0;
            this.friction =0.9;
            this.maxspeed =15;
            this.width =100;
            this.height =100;
            this.active =true;
            this.sum=4;
            this.step = function () {
                if(this.active){
                    //
                    if (!leftKey && !rightKey || leftKey && rightKey ){
                        this.xspeed *=this.friction;
                    } else if(rightKey){
                        this.xspeed ++;
                    }else if(leftKey){
                        this.xspeed --;
                    }
                    //
                    if(upKey){
                        this.yspeed -=15;
                        onGround=false;
                    }
                    this.yspeed +=5;

                    if(this.xspeed > this.maxspeed){
                        this.xspeed = this.maxspeed;
                    } else if(this.xspeed < -this.maxspeed){
                        this.xspeed = -this.maxspeed;
                    }
                    if(this.yspeed > this.maxspeed){
                        this.yspeed = this.maxspeed;
                    } else if(this.yspeed < -this.maxspeed){
                        this.yspeed = -this.maxspeed;
                    }
                    if(this.xspeed >0){
                        this.xspeed = Math.floor(this.xspeed);
                    }else{
                        this.xspeed = Math.ceil(this.xspeed);
                    }
                    if(this.yspeed >0){
                        this.yspeed = Math.floor(this.yspeed);
                    }else{
                        this.yspeed = Math.ceil(this.yspeed);
                    }

                    let horizontalRect ={
                        x: this.x + this.xspeed,
                        y: this.y,
                        width: this.width,
                        height: this.height
                    }
                    let verticalRect ={
                        x: this.x ,
                        y: this.y +this.yspeed,
                        width: this.width,
                        height: this.height
                    }
                    for(let i=0 ; i< borders.length; i++) {
                        let borderRect = {
                            x: borders[i].x,
                            y: borders[i].y,
                            width: borders[i].width,
                            height: borders[i].height,
                            type: borders[i].type
                        }

                        if (checkIntersection(horizontalRect, borderRect)) {
                            while (checkIntersection(horizontalRect,borderRect)){
                                horizontalRect.x -=Math.sign(this.xspeed);
                            }
                            if(borderRect.type ==1){
                                this.x = horizontalRect.x + width;
                                this.xspeed = 0;
                            }else if(borderRect.type ==2) {
                                document.location.reload();}
                            else if(borderRect.type ==3) {
                                borders.splice([i],1);
                                score+=100;
                                document.getElementById("score").innerText = score;
                                console.log(sum);
                                if(sum==0){
                                    alert("winner");
                                    document.location.reload();}
                            } else if(borderRect.type ==4){
                                this.width =50;
                                this.height =50;
                                borders.splice([i],1);

                            }
                        }
                        //
                        if (checkIntersection(verticalRect, borderRect)) {
                            while (checkIntersection(verticalRect,borderRect)){
                                verticalRect.y -=Math.sign(this.yspeed);
                            }if(borderRect.type ==1){
                                this.y = verticalRect.y + width;
                                this.yspeed = 0;
                            }else if(borderRect.type ==2) {
                                document.location.reload();}
                            else if(borderRect.type ==3) {
                                borders.splice([i],1);
                                score+=100;
                                document.getElementById("score").innerText = score;

                                console.log(sum);
                                if(sum==0){
                                    alert("winner");
                                    document.location.reload();}
                            } else if(borderRect.type ==4){
                                this.width =50;
                                this.height =50;
                                borders.splice([i],1);

                            }

                        }

                    }
                    this.x +=this.xspeed;
                    this.y +=this.yspeed;

                }
            }
            this.draw = function () {
                ctx.fillStyle = 'blue';
                ctx.fillRect(this.x , this.y , this.width , this.height)
            }
        }</script>
    <script> </script>
</p>
<canvas width="1280" height="720" id="game-canvas"> </canvas>
<footer> Made by Amirkhan Abishev</footer>
</body>
</html>